# An Electronic Lab Notebook (ELN) Example for Atom Probe Microscopy (APM)

## Introduction

This example shows how the NOMAD ELN functionalities can be used to collect
required metadata for groups, fields, and attributes for creating a dataset
which is compliant with the NeXus NXapm application definition.

The NeXus NXapm data model is documented here [NXapm](https://fairmat-experimental.github.io/nexus-fairmat-proposal)

Specifically, this example works together with vendor/community file formats
(POS, ePOS, APT, and RNG or RRNG, respectively) which contain the tomographic
reconstruction and associated ranging data to interpret ion species from 
mass-to-charge-state ratio values. This ELN can be used to collect metadata which
are currently not stored in vendor or community files including details about the
specimen, the instrument, users, and post-processing steps.

This example upload contains the following entries:
- A schema in NOMAD's *archive.yaml* format: *nxapm.schema.archive.yaml*
- A schema instance file used by NOMAD *nxapm.archive.json* which is filled for educational purpose with values for the example.
- The primary consumer of this json file is NOMAD and its internal data management system.
- Another schema instance file used by the nomad-parser-nexus *eln_data.yaml*. This file contains all entered
quantities from the ELN GUI (after the save button was stored).
The example is also filled for educational purpose with values matching those in nxapm.archive.json.
This file stores metadata with value and units. The file is updated each time the save button in the ELN GUI is clicked.
The file is used by the [NOMAD-PARSER-NEXUS](https://github.com/nomad-coe/nomad-parser-nexus) which creates
NeXus files, like those for atom probe matching the NXapm application definition.

This example is configured to take an example dataset and call the nomad-parser-nexus dataconverter
which creates a NeXus file that is compliant with NXapm. Once completed, this file is available
in the upload section/staging area. This makes also these files explorable with H5Web visualization
through the files menu.

This example comes with a measured dataset which is meant for testing and exploration of the ELN and
NORTH container functionalities. The scientific dataset is a tomographic reconstruction of an
ODS steel specimen which was measured and characterized by [J. Wang and coworkers](https://doi.org/10.1017/S1431927618015386)
- R31_06365-v02.pos (the reconstruction)
- R31_06365-v02.rrng (the range file)

## Creating NeXus files

When you modify the content inside the ELN and click the save button, the data from the ELN will
be parsed and combined with the POS and RRNG file to create the NXS file. You can replace
these files with your own and accordingly use the ELN to enter metadata for your own datasets.
Upon saving, a NeXus/HDF5 file will be created for your specific dataset.

The drag-and-drop functionality of the upload section can be used to pass your reconstruction
and range file onto the respective file upload fields of the ELN. After clicking the save button,
the newly entered metadata and files will be processed on-the-fly and a NeXus file,
compliant with NXapm will be generated.

Currently, the implementation supports reconstructions in POS, ePOS and APT file format
(the one generated by APSuite from AMETEK/Cameca). Range files are accepted in
RNG or RRNG format.

## Where to go from now

With an example in your upload **you should go to the Analytics tab in the** NOMAD OASIS menu bar
and **start up the apmtools container**. The container connects your upload with a set of
containerized software tools for post-processing and exploring atom probe data in substantial more detail.

These tools contain currently the
- [Leoben APT_analyzer](https://github.com/areichm/APT_analyzer) by Alexander Reichmann et al. (Lorenz Romaner's team at Montanuniversit채t Leoben)
- The [paraprobe-toolbox](https://gitlab.com/paraprobe/paraprobe-toolbox) by Markus K체hbach et al. (developed mainly at his time with the Max-Planck-Institut f체r Eisenforschung GmbH)

**Once running, the apmtools container offers a jupyter lab server in which the tools are installed.**
**Further examples are available in the container. To access these you can start with the Cheatsheet.ipynb**
inside the **/home/atom_probe_tools directory.**

Once you have explored the example datasets you should also explore and realize that the
containers are mounted with your uploads section. The respective directory in the apmtools container
is the **/config** directory. The key benefit of this container design is that you can use a simple
command in a jupyter notebook cell after your analyses

```
! mv *.png /config
```

This will move for example all generated figures (replace the file extension with a specific
name or file type) from the working directory in the container into your upload section.
H5Web can be used to display the content of HDF5 files, such as results and config files
of the paraprobe-toolbox. Please keep in mind that the config files for the tools of the
paraprobe-toolbox are already fully described with NeXus. You can find the respective schema descriptions here
[NXapm_paraprobe](https://fairmat-experimental.github.io/nexus-fairmat-proposal)

The result files of these tools however are not yet fully described with NeXus, so no default plots will
be available here but you can still conveniently explore all the data as they are HDF5 files
which H5Web can present to you.

## Summary

The example is meant as a starting point. You can download the schema file and extend it to collect
further metadata (e. g. for adding optional quantities defined in NXapm) based on what is relevant for
your laboratory and use case. Also you can explore the implementation of the example to customize it for
your own needs. We would be happy if you could support us with improving this example and the associated
schemes by leaving us comments via the nexus-fairmat-proposal pages or by contacting us via
the various channels. We are also very happy to guide you on how to customize these functionalities
for your own laboratory and needs.

Consult our [documentation on the NOMAD Archive and Metainfo](https://nomad-lab.eu/prod/v1/docs/archive.html)
to learn more about schemes.

## Questions, comments, suggestions?

For general questions regarding the APM tools and if you're interested in building one for your
own research workflow or your colleagues and group, you are very welcome
[Markus K체hbach](https://www.fair-di.eu/fairmat/fairmat_/fairmatteam) from the FAIRmat consortium.

## Known bugs

